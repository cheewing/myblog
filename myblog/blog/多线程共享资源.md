### 多线程共享资源

按照操作系统原理，进程是系统资源分配的最小单位，线程是cpu调度的最小单位。线程共享进程申请的资源，但是线程有维持自己正常运行的很小的资源，这很小的资源为各个线程独有。

同一个进程中创建的多线程共享的环境包括：

- 进程代码段
- 进程的公有数据（利用这些共享数据，线程很容易实现相互之间的通讯）
- 进程打开的文件描述符
- 信号的处理器
- 进程的当前目录
- 进程用户ID
- 进程组ID

进程拥有这么多共性的同时，还拥有自己的个性。有了这些个性，线程才能实现并发性。这些个性包括：

1. 线程ID

   每个线程都有自己的线程ID，这个ID在本进程中是唯一的。进程用此来标识线程。

2. 寄存器组的值

   由于线程间是并发运行的，每个线程有自己不同的运行线索。当从一个线程切换到另一个线程上时，必须将原有的线程的寄存器集合的状态保存，以便将来该线程在被重新切换到时能得以恢复。

3. 线程的堆栈

   堆栈是保证线程独立运行所必须的。

   线程函数可以调用函数，而被调用函数中又是可以层层嵌套的，所以线程必须拥有自己的函数堆栈，使得函数调用可以正常执行，不受其他线程的影响。

4. 错误返回码

   由于同一个进程中有很多个线程在同时运行，可能某个线程进行系统调用后设置了errno值，而在该线程还没有处理这个错误，另外一个线程就在此时被调度器投入运行，这样错误值就有可能被修改。

   所以，不同的线程应该拥有自己的错误返回码变量。

5. 线程的信号屏蔽码

   由于线程所感兴趣的信号不同，所以线程的信号屏蔽码应该由线程自己管理。但所有的线程都共享同样的信号处理器。

6. 线程的优先级

   由于线程需要像进程那样能够被调度，那么就必须要有可供调度使用的参数，这个参数就是线程的优先级。